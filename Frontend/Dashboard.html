<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventory Overview</title>
    <!-- Resource Hints for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />

    <!-- Optimized Font Loading with display: swap -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap&family=Material+Icons+Outlined&display=swap&display=swap"
      rel="stylesheet"
    />

    <!-- Critical CSS Inline (most used styles) -->
    <style>
      :root {
        --primary-color: #246dec;
        --success-color: #367952;
        --info-color: #4f35a1;
        --warning-color: #f5b747;
        --danger-color: #cc3c43;
      }
      .grid-container {
        display: grid;
        grid-template-columns: 260px 1fr;
        grid-template-rows: auto 1fr;
        grid-template-areas:
          "header header"
          "sidebar main";
        min-height: 100vh;
      }
      .header {
        grid-area: header;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: #fff;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      #sidebar {
        grid-area: sidebar;
        background: #1a1f36;
        color: #fff;
        padding: 1rem;
      }
      .main-container {
        grid-area: main;
        padding: 1.5rem;
        background: #f8fafc;
        overflow-y: auto;
      }
      /* Loading skeleton for faster perceived performance */
      .skeleton {
        background: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e0e0e0 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
      }
      @keyframes shimmer {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }
    </style>

    <!-- Custom CSS (deferred) -->
    <link rel="stylesheet" href="Css/style.css" />
    <link rel="stylesheet" href="Css/responsive.css" />
    <link rel="stylesheet" href="Css/dashboard-redesign.css" />
    <link rel="stylesheet" href="Css/user-profile.css" />
  </head>
  <body>
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="grid-container">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <div class="menu-icon" id="menuIcon">
            <span class="material-icons-outlined">menu</span>
          </div>
          <div class="breadcrumb">
            <span class="material-icons-outlined">dashboard</span>
            <span>Dashboard</span>
          </div>
        </div>
        <div class="header-right">
          <div class="notifications">
            <span class="material-icons-outlined">notifications</span>
            <span class="badge notification-count">3</span>
          </div>
          <span class="material-icons-outlined">email</span>
          <div
            class="user-profile"
            role="button"
            tabindex="0"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <img src="" alt="Profile" class="profile-pic" id="profilePic" />
            <div class="user-menu" role="menu">
              <div class="user-info">
                <img
                  src=""
                  alt="Profile"
                  class="menu-profile-pic"
                  id="menuProfilePic"
                />
                <div class="user-details">
                  <div class="user-display-name" id="menuUserName">User</div>
                  <div class="user-email" id="menuUserEmail">
                    user@example.com
                  </div>
                </div>
              </div>
              <div class="menu-divider"></div>
              <a
                href="#"
                role="menuitem"
                onclick="
                  event.preventDefault();
                  showProfile();
                  return false;
                "
              >
                <span class="material-icons-outlined">person</span>
                View Profile
              </a>
              <a
                href="#"
                role="menuitem"
                onclick="
                  event.preventDefault();
                  editProfilePicture();
                  return false;
                "
              >
                <span class="material-icons-outlined">photo_camera</span>
                Change Picture
              </a>
              <a
                href="#"
                role="menuitem"
                onclick="
                  event.preventDefault();
                  changePassword();
                  return false;
                "
              >
                <span class="material-icons-outlined">lock</span>
                Change Password
              </a>
              <a
                href="#"
                role="menuitem"
                onclick="
                  event.preventDefault();
                  accountSettings();
                  return false;
                "
              >
                <span class="material-icons-outlined">settings</span>
                Account Settings
              </a>
              <a
                href="#"
                role="menuitem"
                onclick="
                  event.preventDefault();
                  helpSupport();
                  return false;
                "
              >
                <span class="material-icons-outlined">help</span>
                Help & Support
              </a>
              <div class="menu-divider"></div>
              <a
                href="#"
                role="menuitem"
                onclick="
                  event.preventDefault();
                  logout();
                  return false;
                "
              >
                > >
                <span class="material-icons-outlined">logout</span>
                Logout
              </a>
            </div>
          </div>
        </div>
      </header>
      <!-- End Header -->

      <!-- Sidebar -->
      <aside id="sidebar">
        <div class="sidebar-title">
          <div class="sidebar-brand">
            <span class="material-icons-outlined"> inventory </span>
            Inventory System
          </div>
          <span class="material-icons-outlined sidebar-close" id="sidebarClose">
            close
          </span>
        </div>

        <ul class="sidebar-list">
          <li class="sidebar-list-item active">
            <a href="Dashboard.html">
              <span class="material-icons-outlined"> dashboard </span>
              Inventory Overview
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="inventory.html">
              <span class="material-icons-outlined"> inventory </span>
              Product Stock
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="audit.html">
              <span class="material-icons-outlined"> fact_check </span>
              Audit Trail
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="supplier.html">
              <span class="material-icons-outlined"> add_shopping_cart </span>
              Supplier Orders
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="customer-orders.html">
              <span class="material-icons-outlined"> shopping_cart </span>
              Customer Orders
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="insights-hub.html">
              <span class="material-icons-outlined"> poll </span>
              Insights Hub
            </a>
          </li>

          <li class="sidebar-list-item">
            <a href="system-config.html">
              <span class="material-icons-outlined"> settings </span>
              System Config
            </a>
          </li>
        </ul>
      </aside>

      <!-- End Sidebar  -->

      <!-- Main -->
      <main class="main-container">
        <div class="page-header">
          <div class="page-title-section">
            <h1>Inventory Overview</h1>
            <p class="page-subtitle">
              Comprehensive dashboard for inventory management and analytics
            </p>
          </div>
        </div>

        <!-- Key Metrics Section -->
        <div class="metrics-overview">
          <div class="metrics-header">
            <h2>Key Performance Indicators</h2>
            <div class="metrics-timeframe">
              <span>Last 30 days</span>
              <span class="material-icons-outlined">expand_more</span>
            </div>
          </div>

          <div class="metrics-grid">
            <div class="metric-card primary">
              <div class="metric-icon">
                <span class="material-icons-outlined">inventory_2</span>
              </div>
              <div class="metric-content">
                <div class="metric-value" id="products-count">249</div>
                <div class="metric-label">Total Products</div>
                <div class="metric-change positive">
                  <span class="material-icons-outlined">trending_up</span>
                  +5.2% from last month
                </div>
              </div>
              <div class="metric-chart">
                <div class="mini-sparkline" id="products-sparkline"></div>
              </div>
            </div>

            <div class="metric-card success">
              <div class="metric-icon">
                <span class="material-icons-outlined">shopping_cart</span>
              </div>
              <div class="metric-content">
                <div class="metric-value" id="purchase-orders-count">83</div>
                <div class="metric-label">Purchase Orders</div>
                <div class="metric-change positive">
                  <span class="material-icons-outlined">trending_up</span>
                  +12.8% from last month
                </div>
              </div>
              <div class="metric-chart">
                <div class="mini-sparkline" id="orders-sparkline"></div>
              </div>
            </div>

            <div class="metric-card info">
              <div class="metric-icon">
                <span class="material-icons-outlined">sell</span>
              </div>
              <div class="metric-content">
                <div class="metric-value" id="sales-orders-count">79</div>
                <div class="metric-label">Sales Orders</div>
                <div class="metric-change positive">
                  <span class="material-icons-outlined">trending_up</span>
                  +8.5% from last month
                </div>
              </div>
              <div class="metric-chart">
                <div class="mini-sparkline" id="sales-sparkline"></div>
              </div>
            </div>

            <div class="metric-card warning">
              <div class="metric-icon">
                <span class="material-icons-outlined">warning</span>
              </div>
              <div class="metric-content">
                <div class="metric-value" id="inventory-alerts-count">58</div>
                <div class="metric-label">Inventory Alerts</div>
                <div class="metric-change negative">
                  <span class="material-icons-outlined">trending_down</span>
                  -3.1% from last month
                </div>
              </div>
              <div class="metric-chart">
                <div class="mini-sparkline" id="alerts-sparkline"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions & Recent Activity -->
        <div class="dashboard-actions-activity">
          <div class="quick-actions-panel">
            <div class="panel-header">
              <h3>Quick Actions</h3>
              <span class="panel-subtitle">Common tasks and shortcuts</span>
            </div>
            <div class="action-grid">
              <a href="inventory.html" class="action-card">
                <div class="action-icon primary">
                  <span class="material-icons-outlined">inventory</span>
                </div>
                <div class="action-content">
                  <h4>Manage Stock</h4>
                  <p>Add, edit, or remove products</p>
                </div>
                <span class="material-icons-outlined action-arrow"
                  >arrow_forward</span
                >
              </a>

              <a href="supplier.html" class="action-card">
                <div class="action-icon success">
                  <span class="material-icons-outlined">add_shopping_cart</span>
                </div>
                <div class="action-content">
                  <h4>New Purchase Order</h4>
                  <p>Create supplier orders</p>
                </div>
                <span class="material-icons-outlined action-arrow"
                  >arrow_forward</span
                >
              </a>

              <a href="customer-orders.html" class="action-card">
                <div class="action-icon info">
                  <span class="material-icons-outlined">shopping_cart</span>
                </div>
                <div class="action-content">
                  <h4>Process Sales Order</h4>
                  <p>Handle customer orders</p>
                </div>
                <span class="material-icons-outlined action-arrow"
                  >arrow_forward</span
                >
              </a>

              <div class="action-card alerts-card" onclick="showAlerts()">
                <div class="action-icon warning">
                  <span class="material-icons-outlined">notifications</span>
                  <span class="alert-badge" id="alert-badge">3</span>
                </div>
                <div class="action-content">
                  <h4>View Alerts</h4>
                  <p>Check inventory alerts</p>
                </div>
                <span class="material-icons-outlined action-arrow"
                  >arrow_forward</span
                >
              </div>

              <a href="insights-hub.html" class="action-card">
                <div class="action-icon secondary">
                  <span class="material-icons-outlined">analytics</span>
                </div>
                <div class="action-content">
                  <h4>View Reports</h4>
                  <p>Generate analytics reports</p>
                </div>
                <span class="material-icons-outlined action-arrow"
                  >arrow_forward</span
                >
              </a>

              <div class="action-card" onclick="showSystemConfig()">
                <div class="action-icon tertiary">
                  <span class="material-icons-outlined">settings</span>
                </div>
                <div class="action-content">
                  <h4>System Settings</h4>
                  <p>Configure system preferences</p>
                </div>
                <span class="material-icons-outlined action-arrow"
                  >arrow_forward</span
                >
              </div>
            </div>
          </div>

          <div class="recent-activity-panel">
            <div class="panel-header">
              <h3>Recent Activity</h3>
              <a href="audit.html" class="view-all-link">View All</a>
            </div>
            <div class="activity-timeline" id="activity-timeline">
              <!-- Activity items will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Analytics Dashboard -->
        <div class="analytics-dashboard">
          <div class="analytics-header">
            <h2>Analytics & Insights</h2>
            <div class="analytics-controls">
              <div class="control-group">
                <label for="time-range">Time Range</label>
                <select id="time-range" class="control-select">
                  <option value="7d">Last 7 days</option>
                  <option value="30d">Last 30 days</option>
                  <option value="90d">Last 90 days</option>
                  <option value="1y">Last year</option>
                </select>
              </div>
              <div class="control-group">
                <label for="category-filter">Category</label>
                <select id="category-filter" class="control-select">
                  <option value="all">All Categories</option>
                  <option value="electronics">Electronics</option>
                  <option value="apparel">Apparel</option>
                  <option value="home">Home & Garden</option>
                  <option value="books">Books</option>
                  <option value="sports">Sports</option>
                </select>
              </div>
              <button class="btn-secondary export-btn" onclick="exportCharts()">
                <span class="material-icons-outlined">download</span>
                Export Data
              </button>
            </div>
          </div>

          <div class="analytics-grid">
            <!-- Revenue & Orders Trend -->
            <div class="analytics-card large featured">
              <div class="card-header">
                <div class="card-title-section">
                  <h3>Revenue & Orders Trend</h3>
                  <span class="card-subtitle"
                    >Monthly performance overview</span
                  >
                </div>
                <div class="card-actions">
                  <span class="featured-badge">Featured</span>
                  <button class="card-menu-btn" onclick="toggleCardMenu(this)">
                    <span class="material-icons-outlined">more_vert</span>
                  </button>
                </div>
              </div>
              <div class="card-content">
                <div id="area-chart" class="chart-container"></div>
              </div>
            </div>

            <!-- Top Products -->
            <div class="analytics-card medium">
              <div class="card-header">
                <div class="card-title-section">
                  <h3>Top Products</h3>
                  <span class="card-subtitle">Best performing items</span>
                </div>
                <button class="card-menu-btn" onclick="toggleCardMenu(this)">
                  <span class="material-icons-outlined">more_vert</span>
                </button>
              </div>
              <div class="card-content">
                <div id="bar-chart" class="chart-container"></div>
              </div>
            </div>

            <!-- Sales by Category -->
            <div class="analytics-card medium">
              <div class="card-header">
                <div class="card-title-section">
                  <h3>Sales by Category</h3>
                  <span class="card-subtitle">Category distribution</span>
                </div>
                <button class="card-menu-btn" onclick="toggleCardMenu(this)">
                  <span class="material-icons-outlined">more_vert</span>
                </button>
              </div>
              <div class="card-content">
                <div id="pie-chart" class="chart-container"></div>
              </div>
            </div>

            <!-- Inventory Health -->
            <div class="analytics-card medium">
              <div class="card-header">
                <div class="card-title-section">
                  <h3>Inventory Health</h3>
                  <span class="card-subtitle">Stock levels overview</span>
                </div>
                <button class="card-menu-btn" onclick="toggleCardMenu(this)">
                  <span class="material-icons-outlined">more_vert</span>
                </button>
              </div>
              <div class="card-content">
                <div id="donut-chart" class="chart-container"></div>
              </div>
            </div>

            <!-- Inventory Trends -->
            <div class="analytics-card medium">
              <div class="card-header">
                <div class="card-title-section">
                  <h3>Inventory Trends</h3>
                  <span class="card-subtitle">Stock movement over time</span>
                </div>
                <button class="card-menu-btn" onclick="toggleCardMenu(this)">
                  <span class="material-icons-outlined">more_vert</span>
                </button>
              </div>
              <div class="card-content">
                <div id="line-chart" class="chart-container"></div>
              </div>
            </div>

            <!-- Performance Metrics -->
            <div class="analytics-card medium">
              <div class="card-header">
                <div class="card-title-section">
                  <h3>Performance Metrics</h3>
                  <span class="card-subtitle">Key performance indicators</span>
                </div>
                <button class="card-menu-btn" onclick="toggleCardMenu(this)">
                  <span class="material-icons-outlined">more_vert</span>
                </button>
              </div>
              <div class="card-content">
                <div id="radar-chart" class="chart-container"></div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- End Main -->

      <!-- Change Password Modal -->
      <div id="changePasswordModal" class="modal">
        <div class="modal-content">
          <span
            class="close-modal"
            onclick="closeModal(document.getElementById('changePasswordModal'))"
            >&times;</span
          >
          <h2 id="changePasswordTitle">Change Password</h2>
          <form id="changePasswordForm">
            <fieldset>
              <legend>Enter New Password</legend>
              <label for="currentPassword">Current Password</label>
              <input
                type="password"
                id="currentPassword"
                required
                placeholder="Enter current password"
              />
              <label for="newPassword">New Password</label>
              <input
                type="password"
                id="newPassword"
                required
                placeholder="Enter new password"
              />
              <label for="confirmNewPassword">Confirm New Password</label>
              <input
                type="password"
                id="confirmNewPassword"
                required
                placeholder="Confirm new password"
              />
              <button type="submit" class="modal-submit-btn">
                Change Password
              </button>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
    <!-- Profile Modals Container (load first) -->
    <div id="profileModalsContainer"></div>

    <!-- Scripts - Optimized loading order -->
    <!-- Defer non-critical scripts to not block rendering -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" defer></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/5.3.5/apexcharts.min.js"
      defer
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/all.min.js"
      defer
    ></script>
    <script src="js/api-client.js" defer></script>
    <script src="js/profile-management.js" defer></script>
    <script src="js/user-profile-component.js" defer></script>
    <script src="js/global-profile-init.js" defer></script>

    <script>
      // Mobile Menu Toggle Functionality
      const menuIcon = document.getElementById("menuIcon");
      const sidebar = document.getElementById("sidebar");
      const sidebarClose = document.getElementById("sidebarClose");
      const sidebarOverlay = document.getElementById("sidebarOverlay");

      function toggleSidebar() {
        sidebar.classList.toggle("active");
        sidebarOverlay.classList.toggle("active");
        document.body.style.overflow = sidebar.classList.contains("active")
          ? "hidden"
          : "";
      }

      function closeSidebar() {
        sidebar.classList.remove("active");
        sidebarOverlay.classList.remove("active");
        document.body.style.overflow = "";
      }

      if (menuIcon) {
        menuIcon.addEventListener("click", toggleSidebar);
      }

      if (sidebarClose) {
        sidebarClose.addEventListener("click", closeSidebar);
      }

      if (sidebarOverlay) {
        sidebarOverlay.addEventListener("click", closeSidebar);
      }

      // Close sidebar on window resize to desktop
      window.addEventListener("resize", () => {
        if (window.innerWidth > 1023) {
          closeSidebar();
        }
      });

      // Optimized profile modals loading with lazy loading
      const loadProfileModals = (() => {
        let loaded = false;
        return async () => {
          if (loaded) return;
          loaded = true;
          console.log("Loading profile modals...");
          try {
            const response = await fetch("profile-modals.html", {
              cache: "force-cache", // Cache for faster reload
            });
            const html = await response.text();
            document.getElementById("profileModalsContainer").innerHTML = html;
            console.log("Profile modals loaded successfully");
            initializeModalListeners();
          } catch (error) {
            console.error("Error loading profile modals:", error);
          }
        };
      })();

      // Optimized modal listeners initialization
      const initializeModalListeners = (() => {
        let initialized = false;
        return () => {
          if (initialized) return;
          initialized = true;
          document.querySelectorAll(".close, [data-modal]").forEach((btn) => {
            if (
              btn.classList.contains("close") ||
              (btn.tagName === "BUTTON" && btn.getAttribute("data-modal"))
            ) {
              btn.addEventListener("click", function () {
                const modalId =
                  this.getAttribute("data-modal") || this.closest(".modal")?.id;
                if (modalId) {
                  closeModal(modalId);
                }
              });
            }
          });
        };
      })();

      // Load modals when DOM is ready
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () =>
          setTimeout(loadProfileModals, 100),
        );
      } else {
        setTimeout(loadProfileModals, 100);
      }
    </script>

    <!-- Defer remaining scripts -->
    <script src="js/dashboard.js" defer></script>
    <script src="js/form-validator.js" defer></script>
    <script src="js/toast-notification.js" defer></script>
  </body>
</html>
